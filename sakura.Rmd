---
title: "sakura"
author: "Yuriko Schumacher"
date: "3/11/2021"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)

sakura.raw <- read_csv("data/sakura_full_bloom.csv")
sakura <- sakura.raw %>% 
  select(-`30 Year Average 1981-2010`, -Notes) %>% 
  gather(key = "year", value = "year.date", "1953":"2020") %>% 
  rename(location = `Site Name`,
         now.observed = `Currently Being Observed`) %>% 
  mutate(date = as.Date(str_sub(year.date, start = 6), tryFormats = c("%m-%d", "%m/%d")))

kyoto <- sakura %>% 
  filter(location == "Kyoto") 

kyoto %>% 
  ggplot(aes(x = date)) +
  geom_histogram(binwidth = 1, color = "white", fill = "#ff9ec9") +
  theme_minimal()

mean.Date(kyoto$date) # 04-06

sakura.1980 <- sakura %>% 
  filter(now.observed == TRUE) %>% 
  filter(year == "1980") %>% 
  filter(location != "Ishigaki Island",
         location != "Minamidaitojima",
         location != "Miyakojima")

sakura.1980 %>% 
  ggplot(aes(x = date)) +
  geom_histogram(binwidth = 3, color = "white", fill = "#ff9ec9") +
  theme_minimal()

sakura.2020 <- sakura %>% 
  filter(now.observed == TRUE) %>% 
  filter(year == "2020") %>% 
    filter(location != "Ishigaki Island",
         location != "Minamidaitojima",
         location != "Miyakojima")

sakura.paired <-  
  rbind(sakura.1980, sakura.2020)


sakura.paired %>% 
    ggplot(aes(x = date)) +
  geom_histogram(color = "white", fill = "#ff9ec9") +
  facet_wrap(~ year, ncol = 1) +
  labs(title ="Distribution of Japan's cherry blossom full bloom date in 1980 and 2020") +
  theme_minimal()


t.test(date ~ year, data = sakura.paired, paired = TRUE)

```


```{r}
install.packages("readxl")
library("readxl")
install.packages("weathermetrics")
library(weathermetrics)

cb.raw <- read_excel("data/raw data/KyotoFullFlower7.xls")


cb.cleaned <- cb.raw[-c(1:25), ] %>% 
  select(year = `Full-flowering dates of Japanese cherry (Prunus jamasakura) at Kyoto, Japan. (Latest version, Jun. 12, 2012)`,
         date_doy = ...2,
         date = ...3,
         source_type = ...5,
         source = ...6) %>% 
  mutate(year = as.numeric(year), 
         date_doy = as.numeric(date_doy),
         month = as.numeric(str_sub(date, end = 1)),
         day = as.numeric(str_sub(date, start = 2)))

cb.al <- cb.cleaned %>% 
  mutate(source_type = ifelse(source_type %in% c("1", "2", "3"), "1", source_type))


write_csv(cb.cleaned, "data/kyoto1200.csv")

ggplot(data = cb.cleaned,
       mapping = aes(x = date_doy, y = -year)) +
  geom_point()
```


```{r}
mean.temp.raw <- read_excel("data/raw data/759Temp7.xls", na = "-999.9")

mean.temp <- mean.temp.raw[-c(1:14), ] %>%
  select(year = `759Temp7.xls`,
         tempC = ...2) 

year <- c(2011, 2012, 2013, 2014, 2015)
tempC <- c(6.8, 8.3, 9.7, 9.0, 9.4)
rows_to_add <- data.frame(year, tempC)

mean.temp.added <- rbind(mean.temp[-1211, ], rows_to_add)

mean.temp.final <- mean.temp.added %>% 
  mutate(
    year = as.numeric(year),
    tempC = as.numeric(tempC),
    tempF = celsius.to.fahrenheit(tempC, round = 2))


sakura <- cbind(cb.cleaned, mean.temp.final) %>% 
  select(-8)

sakura.al <- cbind(cb.al, mean.temp.final) %>% 
  select(-8)

write_csv(sakura, "data/sakura.csv")
write_csv(sakura.al, "data/sakura.al.csv")
```

```{r}

```

